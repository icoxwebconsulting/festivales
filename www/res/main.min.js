var app=angular.module("festival",["ionic","ngCordova","ngCordovaOauth","spotify"]);app.run(function($rootScope,$state,$stateParams,$ionicPlatform){$ionicPlatform.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}),app.config(function($stateProvider,$urlRouterProvider,$ionicConfigProvider){$stateProvider.state("base",{url:"/","abstract":!0,templateUrl:"templates/base.html",controller:"BaseController"}).state("base.login",{url:"login",views:{content:{templateUrl:"templates/user/login.html",controller:"LoginController"}}}).state("base.register",{url:"register",views:{content:{templateUrl:"templates/user/register.html",controller:"RegisterController"}}}).state("menu",{url:"app/","abstract":!0,templateUrl:"templates/menu/main.html",controller:"MenuController"}).state("menu.artist-discover",{url:"artist-discover",views:{content:{templateUrl:"templates/artist/main.html",controller:"MainController"}}}).state("menu.artist-list",{url:"artist-list",views:{content:{templateUrl:"templates/artist/list.html",controller:"ArtistController"}}}).state("menu.schedule",{url:"schedule",views:{content:{templateUrl:"templates/schedule/main.html",controller:"ScheduleController"}}}).state("menu.ticket",{url:"ticket",views:{content:{templateUrl:"templates/ticket/main.html",controller:"TicketController"}}}).state("menu.coolway",{url:"coolway",views:{content:{templateUrl:"templates/coolway/main.html",controller:"CoolwayController"}}}).state("menu.streaming",{url:"streaming",views:{content:{templateUrl:"templates/streaming/main.html",controller:"StreamingController"}}}).state("menu.info",{url:"info",views:{content:{templateUrl:"templates/info/main.html",controller:"InfoController"}}}).state("menu.organizer",{url:"organizer",views:{content:{templateUrl:"templates/info/organizer.html"}}}),$urlRouterProvider.otherwise("/login"),$ionicConfigProvider.views.maxCache(0)}),app.constant("GLOBAL",{FESTIVAL_ID:4,HOST:"http://festivales.dev/app_dev.php/api/",IMAGE:"http://festivales.icox.mobi/",COUNTRY_ISO:"ES"}),app.controller("accountCtrl",function($scope,$state){$scope.state=$state}),app.controller("ArtistController",function($scope,$state,$ionicScrollDelegate,filterFilter,$location,$anchorScroll){function addLetter(code){var letter=String.fromCharCode(code);contacts.push({isLetter:!0,letter:letter}),letters.push(letter)}if($scope.init=function(){$scope.view={}},$scope.init(),"menu.artist-list"==$state.current.name){var letters=$scope.letters=[],contacts=$scope.contacts=[],currentCharCode=" ".charCodeAt(0)-1;window.CONTACTS.sort(function(a,b){return a.first_name>b.first_name?1:-1}).forEach(function(person){var personCharCode=person.first_name.toUpperCase().charCodeAt(0);65>personCharCode&&(personCharCode=35);for(var difference=personCharCode-currentCharCode,i=1;difference>=i;i++)addLetter(currentCharCode+i);currentCharCode=personCharCode,contacts.push(person)});for(var i=currentCharCode+1;i<="Z".charCodeAt(0);i++)addLetter(i);$scope.getItemHeight=function(item){return item.isLetter?25:100},$scope.scrollTop=function(){$ionicScrollDelegate.scrollTop()},$scope.scrollBottom=function(){$ionicScrollDelegate.scrollBottom()};var letterHasMatch={};$scope.getContacts=function(){return letterHasMatch={},contacts.filter(function(item){var itemDoesMatch=!$scope.view.search||item.isLetter||item.first_name.toLowerCase().indexOf($scope.view.search.toLowerCase())>-1||item.last_name.toLowerCase().indexOf($scope.view.search.toLowerCase())>-1;if(!item.isLetter&&itemDoesMatch){var letter=item.first_name.charAt(0).toUpperCase();item.first_name.charCodeAt(0)<65&&(letter="#"),letterHasMatch[letter]=!0}return itemDoesMatch}).filter(function(item){return item.isLetter&&!letterHasMatch[item.letter]?!1:!0})},$scope.clearSearch=function(){$scope.view.search=""}}}),window.CONTACTS=[{id:1,first_name:"@Patrick",last_name:"Adams",country:"Cyprus",ip_address:"153.88.89.148",email:"progers@yata.net"},{id:2,first_name:"Janet",last_name:"Burns",country:"Croatia",ip_address:"209.73.121.212",email:"jgordon@skivee.biz"},{id:3,first_name:"Kathy",last_name:"Chancey",country:"Armenia",ip_address:"164.214.217.162",email:"khamilton@rhynyx.biz"},{id:4,first_name:"Stephanie",last_name:"Dennis",country:"Mauritius",ip_address:"8.199.242.67",email:"sjohnson@jabbertype.mil"},{id:5,first_name:"Jerry",last_name:"Edwards",country:"Thailand",ip_address:"230.207.100.163",email:"jpalmer@avamm.org"},{id:6,first_name:"Lillian",last_name:"Franklin",country:"Germany",ip_address:"150.190.116.1",email:"lfranklin@eare.mil"},{id:7,first_name:"Melissa",last_name:"Gordon",country:"Serbia",ip_address:"162.156.29.99",email:"mgordon@flashset.org"},{id:8,first_name:"Sarah",last_name:"Harris",country:"Grenada",ip_address:"13.177.156.223",email:"sburns@eimbee.info"},{id:9,first_name:"Willie",last_name:"Ingles",country:"Croatia",ip_address:"115.133.81.82",email:"wburton@dynazzy.info"},{id:10,first_name:"Tina",last_name:"Johnson",country:"United States Virgin Islands",ip_address:"113.49.63.18",email:"tsimmons@devpulse.mil"},{id:11,first_name:"Kenneth",last_name:"Kent",country:"Mexico",ip_address:"92.89.76.196",email:"klarson@browseblab.info"},{id:12,first_name:"Philip",last_name:"Lyles",country:"Cuba",ip_address:"223.180.48.70",email:"pwelch@skippad.edu"},{id:13,first_name:"Nicholas",last_name:"Marker",country:"British Indian Ocean Territory",ip_address:"200.150.119.13",email:"nparker@twitternation.net"},{id:14,first_name:"Nicole",last_name:"Nebb",country:"Moldova",ip_address:"47.66.237.205",email:"nwebb@midel.biz"},{id:15,first_name:"Clarence",last_name:"Olsen",country:"China",ip_address:"134.84.246.67",email:"cschmidt@dazzlesphere.net"},{id:16,first_name:"Jessica",last_name:"Peterson",country:"Sao Tome and Principe",ip_address:"211.30.32.109",email:"jmurray@jumpxs.net"},{id:17,first_name:"Willie",last_name:"Quite",country:"US Minor Outlying Islands",ip_address:"158.40.109.208",email:"wschmidt@babbleset.edu"},{id:18,first_name:"Margaret",last_name:"Robertson",country:"Bhutan",ip_address:"252.123.77.101",email:"mevans@voolia.info"},{id:19,first_name:"Arthur",last_name:"Simmons",country:"Faroe Islands",ip_address:"116.5.126.29",email:"amorales@brainlounge.biz"},{id:20,first_name:"Charles",last_name:"55063",country:"Italy",ip_address:"10.43.255.4",email:"cperez@avaveo.net"},{id:21,first_name:"Jeffrey",last_name:"Turner",country:"Liechtenstein",ip_address:"55.140.114.8",email:"jwebb@mynte.net"},{id:22,first_name:"Andrea",last_name:"Upton",country:"Nauru",ip_address:"22.243.12.86",email:"asimpson@browsetype.mil"},{id:23,first_name:"Steve",last_name:"15063",country:"Morocco",ip_address:"21.166.38.112",email:"sreynolds@topiclounge.biz"},{id:24,first_name:"Gerald",last_name:"Veyes",country:"Isle of Man",ip_address:"235.115.15.46",email:"greyes@voolith.biz"},{id:25,first_name:"Judy",last_name:"Washington",country:"Sweden",ip_address:"39.120.240.182",email:"jwashington@oyondu.net"},{id:26,first_name:"Brandon",last_name:"Xi",country:"Vietnam",ip_address:"18.176.165.38",email:"bpatterson@skyba.org"},{id:27,first_name:"Brandon",last_name:"Yore",country:"Vietnam",ip_address:"18.176.165.38",email:"batterson@skyba.org"},{id:28,first_name:"Brandon",last_name:"Zeff",country:"Vietnam",ip_address:"18.176.165.38",email:"bpatterson@skyba.org"}],app.controller("BaseController",function($scope,$state){$scope.state=$state,$scope.view={},$scope.view.navigation=!1}),app.controller("CoolwayController",function($scope){$scope.init=function(){$scope.view={}}}),app.controller("FavoriteController",function($scope){$scope.init=function(){$scope.view={}}}),app.controller("InfoController",function($scope){$scope.init=function(){$scope.view={}}}),app.controller("LoginController",function($scope,$state,$http,$ionicLoading,$ionicPopup,$cordovaOauth){$scope.init=function(){$scope.view={},$scope.data={},$scope.error=!1,$scope.view.loginEmail=!1},$scope.init(),$scope.loginFacebook=function(){$cordovaOauth.facebook("1671907443037216",["email"]).then(function(result){$ionicLoading.show({template:"Verificando ..."})})},$scope.loginGoogle=function(){$cordovaOauth.google("140186210091-bp9lgae3g52hvmro7gse1q2t20gba32v.apps.googleusercontent.com",["email"]).then(function(result){$ionicLoading.show({template:"Verificando ..."})})},$scope.toggleLoginEmail=function(){$scope.view.loginEmail=!$scope.view.loginEmail},$scope.login=function(){$scope.error=!1,$scope.data.email?$scope.data.password?$ionicLoading.show({template:"Verificando ..."}):$ionicPopup.alert({title:"Ingrese su Contraseña"}):$ionicPopup.alert({title:"Ingrese su E-mail"})}}),app.controller("MainController",function($scope,$timeout,playerService){$scope.init=function(){$scope.audio=new Audio,$scope.view={}},$scope.init(),self.chunk=function(arr,size){for(var newArr=[],i=0;i<arr.length;i+=size)newArr.push(arr.slice(i,i+size));return console.info("return",newArr),newArr},$scope.$on("top_tracks",function(evt,data){$scope.view.tracks=self.chunk(data,2)}),$scope.playTrack=function(track){$scope.audio.src=track.preview_url,$scope.audio.play()},$scope.play=function(){$scope.audio.src&&$scope.audio.play()},$scope.stop=function(){$scope.audio.src&&$scope.audio.pause()}}),app.controller("MenuController",function($scope,$ionicModal,Spotify){$scope.init=function(){$scope.view={},$scope.view.show_list="favorites",$scope.view.favorites=!1,$scope.view.notifications=!1,$scope.view.setting={},$scope.view.setting.notifications=!0},$scope.init(),$ionicModal.fromTemplateUrl("templates/user/settings.html",{scope:$scope}).then(function(modal){$scope.modal=modal}),$scope.openSettings=function(){$scope.modal.show()},$scope.closeSettings=function(){$scope.modal.hide()},$scope.login=function(){Spotify.login().then(function(data){console.log(data),alert("You are now logged in")},function(){console.log("didn't log in")})}}),app.controller("notificationController",function($scope){$scope.init=function(){$scope.view={}}}),app.controller("PlayerController",function($scope,$state,$ionicModal,$ionicPlatform,$cordovaOauth,Spotify){$scope.performLogin=function(){$cordovaOauth.spotify($scope.clientId,["user-read-private","playlist-read-private"]).then(function(result){window.localStorage.setItem("spotify-token",result.access_token),Spotify.setAuthToken(result.access_token),$scope.updateInfo()},function(error){console.log("Error -> "+error)})},$scope.stop=function(){$scope.audio.src&&$scope.audio.pause()},$scope.play=function(){$scope.audio.src&&$scope.audio.play()},$ionicModal.fromTemplateUrl("templates/player/login.html",{scope:$scope}).then(function(modal){$scope.modal=modal}),$scope.openPlayer=function(){var storedToken=window.localStorage.getItem("spotify-token");null!==storedToken?(Spotify.setAuthToken(storedToken),$scope.updateInfo()):$scope.performLogin()},$scope.closePlayer=function(){$scope.modal.hide()},$scope.updateInfo=function(){Spotify.getCurrentUser().then(function(data){$scope.getUserPlaylists(data.id)},function(error){$scope.performLogin()})},$scope.getUserPlaylists=function(userid){Spotify.getUserPlaylists(userid).then(function(data){$scope.playlists=data.items})},$scope.init=function(){$scope.state=$state,$scope.view={},$scope.clientId="77b0545674984c768ed449759d5911c8",$scope.playlists=[]},$scope.init()}),app.controller("RegisterController",function($scope,$state,$ionicLoading,$ionicPopup){$scope.data={privacy_police:!1},$scope.error=!1,$scope.signUp=function(){$scope.error=!1,$scope.data.email?$scope.data.password?$scope.data.password!==$scope.data.repassword?$ionicPopup.alert({title:"Confirme su Contraseña"}):$ionicLoading.show({template:"Creando Cuenta ..."}):$ionicPopup.alert({title:"Ingrese su Contraseña"}):$ionicPopup.alert({title:"Ingrese su E-mail"})}}),app.controller("ScheduleController",function($scope){$scope.init=function(){$scope.view={},$scope.view.show_list="time"},$scope.init()}),app.controller("StreamingController",function($scope){$scope.init=function(){$scope.view={}}}),app.controller("TicketController",function($scope){$scope.init=function(){$scope.view={}}}),app.directive("lazyLoad",["$window","$q",function($window,$q){function load_script(){var s=document.createElement("script");s.src="/www.ticketea.com/entradas-festival-les-arts-2016/buy?width=600px&height=600px",document.body.appendChild(s)}function lazyLoadApi(key){var deferred=$q.defer();return $window.initialize=function(){deferred.resolve()},$window.attachEvent?$window.attachEvent("onload",load_script):$window.addEventListener("load",load_script,!1),deferred.promise}return{restrict:"E",link:function(scope,element,attrs){$window.google&&$window.google.maps?console.log("gmaps already loaded"):lazyLoadApi().then(function(){console.log("promise resolved"),$window.google&&$window.google.maps?console.log("gmaps loaded"):console.log("gmaps not loaded")},function(){console.log("promise rejected")})}}}]),app.factory("playerService",function($rootScope,Spotify){var service={};return service.getTopTracks=function(spotifyId,countryIso){Spotify.getArtistTopTracks("4wLXwxDeWQ8mtUIRPxGiD6","ES").then(function(data){$rootScope.$broadcast("top_tracks",data.tracks)})},service.openSpotify=function(link){window.open(link,"_blank","location=yes")},service});