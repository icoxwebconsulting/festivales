var app=angular.module("festival",["ionic","ngCordova","ngCordovaOauth","spotify"]);app.run(function($rootScope,$state,$stateParams,$ionicPlatform){$ionicPlatform.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}),app.config(function($stateProvider,$urlRouterProvider,$ionicConfigProvider){$stateProvider.state("base",{url:"/","abstract":!0,templateUrl:"templates/base.html",controller:"BaseController"}).state("base.login",{url:"login",views:{content:{templateUrl:"templates/user/login.html",controller:"LoginController"}}}).state("base.register",{url:"register",views:{content:{templateUrl:"templates/user/register.html",controller:"RegisterController"}}}).state("menu",{url:"app/","abstract":!0,templateUrl:"templates/menu/main.html",controller:"MenuController"}).state("menu.discover",{url:"artist/discover",views:{content:{templateUrl:"templates/artist/discover.html",controller:"MainController"}}}).state("menu.ticket",{url:"ticket",views:{content:{templateUrl:"templates/ticket/main.html",controller:"TicketController"}}}).state("menu.coolway",{url:"coolway",views:{content:{templateUrl:"templates/coolway/main.html",controller:"CoolwayController"}}}).state("menu.streaming",{url:"streaming",views:{content:{templateUrl:"templates/streaming/main.html",controller:"StreamingController"}}}).state("menu.info",{url:"info",views:{content:{templateUrl:"templates/info/main.html",controller:"InfoController"}}}).state("menu.organizer",{url:"organizer",views:{content:{templateUrl:"templates/info/organizer.html"}}}),$urlRouterProvider.otherwise("/login"),$ionicConfigProvider.views.maxCache(0)}),app.constant("GLOBAL",{HOST:"http://festivales.dev/app_dev.php/api/",IMAGE:"http://festivales.icox.mobi/",COUNTRY_ISO:"ES"}),app.controller("accountCtrl",function($scope,$state){$scope.state=$state}),app.controller("BaseController",function($scope,$state){$scope.state=$state,$scope.view={},$scope.view.navigation=!1}),app.controller("CoolwayController",function($scope){$scope.init=function(){$scope.view={}}}),app.controller("FavoriteController",function($scope){$scope.init=function(){$scope.view={}}}),app.controller("InfoController",function($scope){$scope.init=function(){$scope.view={}}}),app.controller("LoginController",function($scope,$state,$http,$ionicLoading,$ionicPopup,$cordovaOauth){$scope.init=function(){$scope.view={},$scope.data={},$scope.error=!1,$scope.view.loginEmail=!1},$scope.init(),$scope.loginFacebook=function(){$cordovaOauth.facebook("1671907443037216",["email"]).then(function(result){$ionicLoading.show({template:"Verificando ..."})})},$scope.loginGoogle=function(){$cordovaOauth.google("140186210091-bp9lgae3g52hvmro7gse1q2t20gba32v.apps.googleusercontent.com",["email"]).then(function(result){$ionicLoading.show({template:"Verificando ..."})})},$scope.toggleLoginEmail=function(){$scope.view.loginEmail=!$scope.view.loginEmail},$scope.login=function(){$scope.error=!1,$scope.data.email?$scope.data.password?$ionicLoading.show({template:"Verificando ..."}):$ionicPopup.alert({title:"Ingrese su Contraseña"}):$ionicPopup.alert({title:"Ingrese su E-mail"})}}),app.controller("MainController",function($scope,$timeout,playerService){$scope.init=function(){$scope.audio=new Audio,$scope.view={}},$scope.init(),self.chunk=function(arr,size){for(var newArr=[],i=0;i<arr.length;i+=size)newArr.push(arr.slice(i,i+size));return console.info("return",newArr),newArr},$scope.$on("top_tracks",function(evt,data){$scope.view.tracks=self.chunk(data,2)}),$scope.playTrack=function(track){$scope.audio.src=track.preview_url,$scope.audio.play()},$scope.play=function(){$scope.audio.src&&$scope.audio.play()},$scope.stop=function(){$scope.audio.src&&$scope.audio.pause()}}),app.controller("MenuController",function($scope,$ionicModal,Spotify){$scope.init=function(){$scope.view={},$scope.view.show_list="favorites",$scope.view.favorites=!1,$scope.view.notifications=!1,$scope.view.setting={},$scope.view.setting.notifications=!0},$scope.init(),$ionicModal.fromTemplateUrl("templates/user/settings.html",{scope:$scope}).then(function(modal){$scope.modal=modal}),$scope.openSettings=function(){$scope.modal.show()},$scope.closeSettings=function(){$scope.modal.hide()},$scope.login=function(){Spotify.login().then(function(data){console.log(data),alert("You are now logged in")},function(){console.log("didn't log in")})}}),app.controller("notificationController",function($scope){$scope.init=function(){$scope.view={}}}),app.controller("PlayerController",function($scope,$state,$ionicModal,$ionicPlatform,$cordovaOauth,Spotify){$scope.state=$state,$scope.view={},$scope.stop=function(){$scope.audio.src&&$scope.audio.pause()},$scope.play=function(){$scope.audio.src&&$scope.audio.play()},$ionicModal.fromTemplateUrl("templates/player/login.html",{scope:$scope}).then(function(modal){$scope.modal=modal}),$scope.openPlayer=function(){$scope.modal.show()},$scope.closePlayer=function(){$scope.modal.hide()};var clientId="77b0545674984c768ed449759d5911c8";$scope.playlists=[],$scope.performLogin=function(){$cordovaOauth.spotify(clientId,["user-read-private","playlist-read-private"]).then(function(result){window.localStorage.setItem("spotify-token",result.access_token),Spotify.setAuthToken(result.access_token),$scope.updateInfo()},function(error){console.log("Error -> "+error)})},$scope.updateInfo=function(){Spotify.getCurrentUser().then(function(data){$scope.getUserPlaylists(data.id)},function(error){$scope.performLogin()})},$ionicPlatform.ready(function(){var storedToken=window.localStorage.getItem("spotify-token");null!==storedToken?(Spotify.setAuthToken(storedToken),$scope.updateInfo()):$scope.performLogin()}),$scope.getUserPlaylists=function(userid){Spotify.getUserPlaylists(userid).then(function(data){$scope.playlists=data.items})}}),app.controller("RegisterController",function($scope,$state,$ionicLoading,$ionicPopup){$scope.data={privacy_police:!1},$scope.error=!1,$scope.signUp=function(){$scope.error=!1,$scope.data.email?$scope.data.password?$scope.data.password!==$scope.data.repassword?$ionicPopup.alert({title:"Confirme su Contraseña"}):$ionicLoading.show({template:"Creando Cuenta ..."}):$ionicPopup.alert({title:"Ingrese su Contraseña"}):$ionicPopup.alert({title:"Ingrese su E-mail"})}}),app.controller("StreamingController",function($scope){$scope.init=function(){$scope.view={}}}),app.controller("TicketController",function($scope){$scope.init=function(){$scope.view={}}}),app.directive("lazyLoad",["$window","$q",function($window,$q){function load_script(){var s=document.createElement("script");s.src="/www.ticketea.com/entradas-festival-les-arts-2016/buy?width=600px&height=600px",document.body.appendChild(s)}function lazyLoadApi(key){var deferred=$q.defer();return $window.initialize=function(){deferred.resolve()},$window.attachEvent?$window.attachEvent("onload",load_script):$window.addEventListener("load",load_script,!1),deferred.promise}return{restrict:"E",link:function(scope,element,attrs){$window.google&&$window.google.maps?console.log("gmaps already loaded"):lazyLoadApi().then(function(){console.log("promise resolved"),$window.google&&$window.google.maps?console.log("gmaps loaded"):console.log("gmaps not loaded")},function(){console.log("promise rejected")})}}}]),app.factory("playerService",function($rootScope,Spotify){var service={};return service.getTopTracks=function(spotifyId,countryIso){Spotify.getArtistTopTracks("4wLXwxDeWQ8mtUIRPxGiD6","ES").then(function(data){$rootScope.$broadcast("top_tracks",data.tracks)})},service.openSpotify=function(link){window.open(link,"_blank","location=yes")},service});